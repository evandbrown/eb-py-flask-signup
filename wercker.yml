box: wercker-labs/docker
build:
  steps:
    - script:
        name: Build and package the Docker image
        code: |
          cd $WERCKER_SOURCE_DIR
          sudo docker build -t evandbrown/eb-py-flask .
          CONTAINER_ID=$(sudo docker run -d evandbrown/eb-py-flask)
          sudo docker export $CONTAINER_ID > container.tar
          DATETIME=`date +%s`
          tar -cvzf $WERCKER_OUTPUT_DIR/docker-$DATETIME.tgz container.tar Docker.mf
deploy:
  steps:
    - pip-install:
        requirements_file: ""
        packages_list: "awscli"
    - script:
        name: Synchronize build output to S3
        code: |
          aws s3 sync . $DEPLOY_BUCKET/$EB_APP_NAME/$ENVIRONMENT
      